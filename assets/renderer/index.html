<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>MIKAæ–‡ç« é˜…è¯»å™¨</title>
    <!-- ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•ç”¨CSS -->
    <link rel="stylesheet" href="styles.css">
    <!-- æ·»åŠ å†…è”æ ·å¼ä½œä¸ºå¤‡ä»½ -->
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 16px;
            line-height: 1.6;
        }
        #content {
            max-width: 800px;
            margin: 0 auto;
            padding: 16px;
        }
        h1 { font-size: 1.8em; }
        p { margin-bottom: 1em; }
        
        /* è°ƒè¯•é¢æ¿æ ·å¼ */
        #debug-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 8px;
            font-size: 12px;
            max-height: 30vh;
            overflow-y: auto;
            z-index: 9999;
            display: none;
        }
        .debug-message {
            margin: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 4px;
        }
        #debug-toggle {
            position: fixed;
            bottom: 10px;
            right: 10px;
            z-index: 10000;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            line-height: 1;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <article id="content">
            <p>æ­£åœ¨åŠ è½½æ–‡ç« å†…å®¹...</p>
        </article>
    </div>
    
    <!-- è°ƒè¯•é¢æ¿ -->
    <div id="debug-panel"></div>
    <button id="debug-toggle" title="æ˜¾ç¤º/éšè—è°ƒè¯•ä¿¡æ¯">ğŸ</button>
    
    <script>
        // æ·»åŠ è°ƒè¯•æ—¥å¿—åŠŸèƒ½
        let debugMessages = [];
        const MAX_DEBUG_MESSAGES = 100;
        
        function logToFlutter(message) {
            console.log(`[MIKA_LOG] ${message}`);
            addDebugMessage(`[FLUTTER] ${message}`);
            try {
                if (window.flutter_inappwebview) {
                    window.flutter_inappwebview.callHandler('logMessage', message);
                }
            } catch (e) {
                console.error('Error calling Flutter handler:', e);
                addDebugMessage(`[ERROR] è°ƒç”¨Flutterå¤„ç†å™¨å¤±è´¥: ${e.message}`);
            }
        }
        
        function addDebugMessage(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugMessages.push(`[${timestamp}] ${message}`);
            if (debugMessages.length > MAX_DEBUG_MESSAGES) {
                debugMessages.shift();
            }
            updateDebugPanel();
        }
        
        function updateDebugPanel() {
            const panel = document.getElementById('debug-panel');
            if (panel) {
                panel.innerHTML = debugMessages
                    .map(msg => `<div class="debug-message">${msg}</div>`)
                    .join('');
                panel.scrollTop = panel.scrollHeight;
            }
        }
        
        // åˆå§‹åŒ–è°ƒè¯•é¢æ¿
        document.getElementById('debug-toggle').addEventListener('click', function() {
            const panel = document.getElementById('debug-panel');
            if (panel.style.display === 'block') {
                panel.style.display = 'none';
            } else {
                panel.style.display = 'block';
                updateDebugPanel();
            }
        });
        
        // æ˜¾ç¤ºä¸€äº›åˆå§‹ä¿¡æ¯
        addDebugMessage('HTMLé¡µé¢å·²åŠ è½½');
        addDebugMessage(`ç”¨æˆ·ä»£ç†: ${navigator.userAgent}`);
        addDebugMessage(`URL: ${window.location.href}`);
        
        // è·å–æ–‡ç« ID
        let articleId;
        try {
            const urlParams = new URLSearchParams(window.location.search);
            articleId = urlParams.get('id');
            addDebugMessage(`æ–‡ç« ID: ${articleId || 'æœªè·å–åˆ°ID'}`);
            logToFlutter(`é¡µé¢åŠ è½½ï¼Œè·å–åˆ°æ–‡ç« ID: ${articleId || 'æœªè·å–åˆ°ID'}`);
        } catch (e) {
            addDebugMessage(`è·å–æ–‡ç« IDå¤±è´¥: ${e.message}`);
        }
        
        // è®¾ç½®å…¨å±€å‡½æ•°ä¾›Flutterè°ƒç”¨
        window.setDarkMode = function(isDark) {
            addDebugMessage(`è®¾ç½®æš—æ¨¡å¼: ${isDark}`);
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
        };
        
        window.setFontSize = function(size) {
            addDebugMessage(`è®¾ç½®å­—ä½“å¤§å°: ${size}`);
            document.documentElement.setAttribute('data-font-size', size);
            document.documentElement.style.setProperty('--font-size', `${size}px`);
        };
        
        window.highlightVocabulary = function(show) {
            addDebugMessage(`æ˜¾ç¤ºè¯æ±‡: ${show}`);
            document.documentElement.setAttribute('data-show-vocabulary', show);
        };
        
        // æµ‹è¯•èµ„æºåŠ è½½
        const testScript = document.createElement('script');
        testScript.onerror = () => addDebugMessage('âŒ æ— æ³•åŠ è½½renderer.jsè„šæœ¬');
        testScript.onload = () => {
            addDebugMessage('âœ… renderer.jsè„šæœ¬åŠ è½½æˆåŠŸ');
            // åˆå§‹åŒ–æ¸²æŸ“å™¨
            window.renderer = new ArticleRenderer();
            // åŠ è½½æ–‡ç« 
            if (articleId) {
                window.renderer.loadArticle(articleId);
            }
        };
        testScript.src = 'renderer.js';
        document.head.appendChild(testScript);
        
        const testCss = document.createElement('link');
        testCss.rel = 'stylesheet';
        testCss.onerror = () => addDebugMessage('âŒ æ— æ³•åŠ è½½styles.cssæ ·å¼');
        testCss.onload = () => addDebugMessage('âœ… styles.cssæ ·å¼åŠ è½½æˆåŠŸ');
        testCss.href = 'styles.css';
        document.head.appendChild(testCss);
    </script>
    
    <!-- ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•ç”¨JS -->
    <script src="renderer.js"></script>
</body>
</html> 